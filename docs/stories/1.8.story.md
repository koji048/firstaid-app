# Story 1.8: First Aid Guide - Guide Detail View

## Story Information

**Epic**: 1 - MVP Core Features  
**Story Number**: 1.8  
**Title**: First Aid Guide - Guide Detail View  
**Status**: Approved

## Story Statement

**As a** user,  
**I want** clear, easy-to-follow first aid instructions,  
**So that** I can confidently provide assistance.

## Acceptance Criteria

1. Clean, readable guide layout
2. Step-by-step navigation
3. Image zoom functionality
4. Text size adjustment
5. Bookmark functionality
6. Share guide capability

## Dev Notes

### Previous Story Insights

From Story 1.7 implementation:

- Guide browsing and search UI successfully implemented
- Navigation to GuideDetailScreen is configured in GuidesStack
- Redux store has guide state management with currentGuide state
- Guide data structure includes full content with steps, warnings, when_to_call
- High contrast mode toggle available (stored locally in screens)
- Emergency-optimized components with large touch targets established
- GuideContentService loads all 50 guides with complete content

### Guide Data Model

From FirstAidGuide interface [Source: architecture/data-models.md#firstaidguide-model]:

```typescript
interface FirstAidGuide {
  id: string;
  title: string;
  category: GuideCategory;
  severity: SeverityLevel;
  content: GuideContent;
  searchTags: string[];
  isOfflineAvailable: boolean;
  viewCount: number;
  lastReviewedAt: Date;
  createdAt: Date;
  updatedAt: Date;
}

interface GuideContent {
  summary: string;
  steps: GuideStep[];
  warnings: string[];
  whenToCallEmergency: string[];
}

interface GuideStep {
  order: number;
  title: string;
  description: string;
  duration?: number; // seconds
}
```

### UI Design Requirements

Based on UI Guidelines [Source: architecture/ui-guideline.md]:

- Sharp corners (no rounded corners) following IBM design philosophy
- Generous spacing: `px-12 py-8` mobile, `px-16 py-12` desktop
- Light typography weights for headlines
- High contrast text (WCAG AAA - 7:1 ratio for emergency mode)
- Minimal color usage - strategic emphasis only
- Clean, data-first design

### Emergency Context Design

For emergency situations, the detail view must:

- Large, easily tappable step navigation (56x56dp minimum)
- High contrast mode support (consistent with browse screens)
- Clear visual hierarchy with step numbers prominently displayed
- One-handed operation for all critical actions
- Minimal cognitive load - show one step at a time option
- Quick access to emergency dial from any step

### Navigation and Screen Location

GuideDetailScreen exists at [Source: architecture/unified-project-structure.md]:

- `/src/screens/guides/GuideDetailScreen.tsx` - Currently a placeholder

Navigation params should receive:

```typescript
type GuideDetailScreenParams = {
  guideId: string;
};
```

### Component Structure

Guide detail components should be organized as:

```
src/components/guides/
├── StepNavigator/
│   ├── StepNavigator.tsx
│   ├── StepNavigator.styles.ts
│   └── index.ts
├── GuideHeader/
│   ├── GuideHeader.tsx
│   ├── GuideHeader.styles.ts
│   └── index.ts
├── StepContent/
│   ├── StepContent.tsx
│   ├── StepContent.styles.ts
│   └── index.ts
└── GuideWarnings/
    ├── GuideWarnings.tsx
    ├── GuideWarnings.styles.ts
    └── index.ts
```

### State Management Integration

Redux slice actions to use [Source: Story 1.7 implementation]:

- `setCurrentGuide(guide)` - Set the guide being viewed
- `toggleBookmark(guideId)` - Add/remove bookmark
- `incrementViewCount(guideId)` - Track guide views
- `addToRecent(guideId)` - Add to recent guides

### Styling and Theme

From theme.ts [Source: /src/styles/theme.ts]:

- Typography scales: largeTitle (34), title1 (28), title2 (22), headline (17), body (17)
- Colors: primary (#007AFF), danger (#FF3B30), success (#34C759)
- Spacing: xs (4), sm (8), md (16), lg (24), xl (32)
- Emergency severity colors from Story 1.7 to maintain consistency

### Share Functionality

For sharing guides:

- Use React Native Share API
- Share format should include: Title, Summary, and app deep link
- Include warning about medical advice disclaimer

### Accessibility Requirements

- Screen reader support with descriptive labels for each step
- Keyboard navigation support for step-by-step movement
- Voice-over announces current step number and total steps
- High contrast mode must apply to all text elements
- Pinch-to-zoom for any images (future enhancement)

### Performance Considerations

- Guide content is already loaded in memory from GuideContentService
- Implement step pre-loading for smooth transitions
- Use React.memo for step components to prevent unnecessary re-renders
- Lazy load images if added in future

## Tasks / Subtasks

### Task 1: Create Guide Header Component (AC: 1, 5)

- [ ] Create GuideHeader component at `/src/components/guides/GuideHeader/`
  - [ ] Display guide title with largeTitle typography (34px)
  - [ ] Show category badge with severity color coding
  - [ ] Add bookmark toggle button (min 44x44dp)
  - [ ] Display estimated total time (sum of step durations)
  - [ ] Add share button in header (min 44x44dp)
  - [ ] Implement haptic feedback for bookmark toggle
- [ ] Style with generous padding and emergency severity colors
- [ ] Add accessibility labels for all interactive elements
- [ ] Write unit tests for GuideHeader

### Task 2: Create Step Navigation Component (AC: 2)

- [ ] Create StepNavigator component at `/src/components/guides/StepNavigator/`
  - [ ] Display current step number and total steps (e.g., "Step 2 of 5")
  - [ ] Add previous/next buttons with min 56x56dp touch targets
  - [ ] Implement progress bar showing completion
  - [ ] Add "View All Steps" toggle for overview mode
  - [ ] Disable previous on first step, next on last step
  - [ ] Add swipe gestures for step navigation
- [ ] Ensure one-handed operation with bottom placement
- [ ] Add haptic feedback for step changes
- [ ] Write unit tests including gesture testing

### Task 3: Create Step Content Component (AC: 1, 2)

- [ ] Create StepContent component at `/src/components/guides/StepContent/`
  - [ ] Display step title with title2 typography (22px)
  - [ ] Show step description with body typography (17px)
  - [ ] Add step duration indicator if available
  - [ ] Implement smooth transitions between steps
  - [ ] Add step number badge with high visibility
  - [ ] Support for future image content with placeholder
- [ ] Apply high contrast mode support
- [ ] Ensure minimum line height for readability
- [ ] Write unit tests for step transitions

### Task 4: Create Guide Warnings Component (AC: 1)

- [ ] Create GuideWarnings component at `/src/components/guides/GuideWarnings/`
  - [ ] Display warnings with danger color (#FF3B30)
  - [ ] Show "When to Call Emergency" section prominently
  - [ ] Use icon + text for better recognition
  - [ ] Expandable/collapsible for space efficiency
  - [ ] Always visible indicator when collapsed
- [ ] Style with high contrast borders
- [ ] Add screen reader announcements for warnings
- [ ] Write unit tests

### Task 5: Implement Text Size Adjustment (AC: 4)

- [ ] Create TextSizeControl component
  - [ ] Add increase/decrease buttons (min 44x44dp)
  - [ ] Support 3 size levels: Normal, Large, Extra Large
  - [ ] Store preference in AsyncStorage
  - [ ] Apply to all text in guide content
  - [ ] Show current size indicator
- [ ] Integrate with StepContent component
- [ ] Ensure layout remains readable at all sizes
- [ ] Write tests for size persistence

### Task 6: Implement Share Functionality (AC: 6)

- [ ] Add share handler to GuideHeader component
  - [ ] Format share content with title and summary
  - [ ] Include app store link for downloading app
  - [ ] Add medical disclaimer to shared content
  - [ ] Use React Native Share API
  - [ ] Track share events for analytics
- [ ] Handle share errors gracefully
- [ ] Test on both iOS and Android platforms
- [ ] Write unit tests with mocked Share API

### Task 7: Update GuideDetailScreen (AC: 1, 2, 3, 4, 5, 6)

- [ ] Replace placeholder with full implementation
  - [ ] Receive guideId from navigation params
  - [ ] Load guide from Redux store
  - [ ] Implement screen layout with components
  - [ ] Add high contrast mode toggle in header
  - [ ] Handle loading and error states
  - [ ] Track view count on mount
  - [ ] Add to recent guides on mount
  - [ ] Implement pull-to-refresh to reset to step 1
- [ ] Configure navigation header with back button
- [ ] Add deep linking support for specific guides
- [ ] Write screen tests

### Task 8: Add Image Support Infrastructure (AC: 3)

- [ ] Create ImageViewer component placeholder
  - [ ] Prepare for future pinch-to-zoom functionality
  - [ ] Add placeholder UI for guides without images
  - [ ] Design image loading states
  - [ ] Plan for offline image caching
- [ ] Document image requirements for future content
- [ ] Create image optimization guidelines
- [ ] Write placeholder tests

### Task 9: Implement Emergency Features

- [ ] Add emergency dial button to screen header
  - [ ] Always visible during guide viewing
  - [ ] Large touch target (56x56dp)
  - [ ] High contrast styling
  - [ ] One-tap dialing with confirmation
- [ ] Add "Emergency Mode" banner when activated
  - [ ] Increases all touch targets
  - [ ] Simplifies UI to essential elements
  - [ ] Auto-enables high contrast
- [ ] Implement shake-to-reset to step 1
- [ ] Add haptic feedback for all emergency actions
- [ ] Write emergency feature tests

### Task 10: Redux Integration and State Management

- [ ] Connect GuideDetailScreen to Redux store
  - [ ] Select current guide from state
  - [ ] Dispatch view count increment
  - [ ] Dispatch bookmark toggle
  - [ ] Dispatch add to recent
- [ ] Add persistence for:
  - [ ] Text size preference
  - [ ] View all steps preference
  - [ ] Last viewed step per guide
- [ ] Implement proper cleanup on unmount
- [ ] Write integration tests

### Task 11: Add Accessibility and Polish (AC: 1, 2, 4)

- [ ] Add comprehensive screen reader support
  - [ ] Announce step changes
  - [ ] Read warnings with urgency
  - [ ] Describe navigation state
- [ ] Implement keyboard navigation
  - [ ] Arrow keys for steps
  - [ ] Tab through interactive elements
  - [ ] Escape to go back
- [ ] Add loading skeletons for smooth experience
- [ ] Ensure focus management between steps
- [ ] Test with VoiceOver (iOS) and TalkBack (Android)
- [ ] Validate WCAG AAA compliance
- [ ] Write accessibility tests

## Testing

### Test File Locations

Following testing strategy [Source: architecture/testing-strategy.md]:

- Component tests: `/__tests__/components/guides/`
- Screen tests: `/__tests__/screens/guides/`
- Integration tests: `/__tests__/integration/guideDetail.test.ts`

### Testing Standards

- Use React Native Testing Library for component tests
- Mock GuideContentService for unit tests
- Test offline scenarios
- Verify text size adjustment persistence
- Test emergency features thoroughly
- Validate accessibility with automated tools

### Test Coverage Requirements

1. Step navigation flows (forward, backward, swipe)
2. Bookmark functionality and persistence
3. Share content formatting
4. Text size adjustment across all content
5. High contrast mode application
6. Emergency dial integration
7. View count and recent guides tracking
8. Error states and edge cases
9. Accessibility compliance

## Notes

This story implements the guide detail view for displaying the 50 first aid guides created in Story 1.6. The focus is on clear, readable presentation optimized for emergency use with features like step-by-step navigation, text size adjustment, and quick sharing. The implementation must maintain consistency with the emergency-optimized UI patterns established in Story 1.7 while providing a focused, distraction-free reading experience for critical first aid instructions.

Image zoom functionality (AC 3) is partially addressed by creating the infrastructure for future image support, as the current guide content from Story 1.6 does not include images yet.

## Dev Agent Record

### Agent Model Used

- Development Agent: [To be filled by dev agent]

### Progress Log

- [ ] Story Started: [Date]
- [ ] Story Completed: [Date]

### Completion Notes

[To be filled by dev agent]

### Debug Log References

[To be filled by dev agent]

### File List

[To be filled by dev agent]

### Change Log

[To be filled by dev agent]

## QA Results

### Review Date: [To be filled]

### Reviewed By: [To be filled]

### Test Results

[To be filled by QA]

### Issues Found

[To be filled by QA]

### Recommendations

[To be filled by QA]
